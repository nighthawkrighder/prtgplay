# Apache WebSocket Proxy Configuration for PRTG Dashboard
# This configuration should be added to your Apache VirtualHost for prtg.lanairgroup.com

# Enable required modules (add to main Apache config if not already enabled):
# LoadModule proxy_module modules/mod_proxy.so
# LoadModule proxy_http_module modules/mod_proxy_http.so
# LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so

# WebSocket Proxy Configuration
# This proxies WebSocket connections from HTTPS to the Node.js server on port 3010

<IfModule mod_proxy.so>
    # Enable proxying
    ProxyRequests Off
    ProxyPreserveHost On

    # WebSocket upgrade handling
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)           ws://localhost:3010/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*)           http://localhost:3010/$1 [P,L]

    # Proxy settings
    ProxyPass / http://localhost:3010/ upgrade=websocket
    ProxyPassReverse / http://localhost:3010/

    # Timeout settings for WebSocket
    ProxyTimeout 3600
</IfModule>

# Alternative configuration if the above doesn't work:
# <Location />
#     ProxyPass ws://localhost:3010/
#     ProxyPassReverse ws://localhost:3010/
# </Location>
